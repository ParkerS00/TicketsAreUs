version: '3.1'
name: ticketsareus

services:
  db:
    image: postgres
    restart: always
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_HOST: postgres
    volumes:
      - ../Dump/20240215.09.46.07.sql:/docker-entrypoint-initdb.d/database.sql
    networks:
      - databaseTunnel

  blazorapp:
    depends_on:
      - db
    build: ..
    ports:
      - 4560:8080
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - pec_tickets=user id= postgres; password=postgres; server=db; database= postgres; port= 5432
    networks:
      - databaseTunnel
    healthcheck:
      test: wget --tries=1 http://localhost:8080/health || exit 1
      interval: 2s
      retries: 5
      start_period: 5s
      timeout: 1s
    restart: unless-stopped

networks:
  databaseTunnel:
    driver: bridge
